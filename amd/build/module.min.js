/**
 * Manager for the blc_modules block.
 *
 * @module block_blc_modules/module
 * @author      Yahya Rais <yahya@teruselearning.co.uk>
 * @copyright   2022 Terus Technology LTD
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
var root=M.cfg.wwwroot,x="";define("block_blc_modules/module",["jquery","block_blc_modules/tippy","block_blc_modules/select2"],(function($,tippy,select2){return{getUrlParameter:getUrlParameter,fillSubject:fillSubject,checkVersion:checkVersion,fillscorm:fillscorm,updateScorm:updateScorm,init:function(){var pageURL=$(location).attr("href"),id=getUrlParameter(pageURL=(pageURL=pageURL.split("&")[0]).split("#")[0],"id"),notifyeditingon=$("#userediting").val();1==notifyeditingon&&checkVersion(id);if($("#addscorm").hasClass("block_blc_modules")){notifyeditingon=$("#userediting").val();var allowstealthval=$("#allowstealthvalue").val(),allowstealthstring="";1==allowstealthval&&(allowstealthstring='<option value="-1">Make available but not shown</option>');var completionon=$("#completionon").val(),completionstring="";completionstring=1==completionon?'<select class="custom-select " name="completion" id="id_completion"> <option value="0">Off</option> <option value="1" >Manual</option> <option value="2" selected="">Automatic</option> </select> <div class="form-control-feedback invalid-feedback" id="id_error_completion">':'<p>Activity completion is not enabled on this course.</p><div class="form-control-feedback invalid-feedback" id="id_error_completion">',$(".course-content").append('\n                <div style="display:none;" class="modal fade" id="bsModal3" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">\n                    <div class="modal-dialog modal-md">\n                        <div class="modal-content">\n                            <div class="modal-header">\n                                <h4 class="modal-title" id="mySmallModalLabel">\n                                    Select BLC Modules\n                                </h4>\n                            </div>\n                        <div class="modal-body">\n                            <p class="statusMsg"></p>\n                            <form role="form">\n                            <div class="form-group">\n                                <select style="width:100%;" class="form-control select2" id="scormsubject" name="scormsubject">\n                                    <option disabled selected>Select a module</option>\n                                </select>\n                            </div>\n                            <div class="form-group">\n                                <select style="min-width:100%;" class="form-control" id="scormurls" name="scormurls" multiple></select>\n                            </div>\n                            <div class="additional_settings">\n                                <h3>SCORM Settings</h3>\n                                <div class="blcrow">\n                                    <div class="blcrow">\n                                        <span style="float:left; margin-right:10px;" class="text-nowrap">\n                                            <a style="box-shadow: none; background: none; padding-bottom:3px !important; border:none;" class="btn btn-link p-0 avail" id="" role="button" data-container="body" data-toggle="popover" data-placement="right" data-content="<div class=&quot;no-overflow&quot;><p>If the availability is set to \'Show on course page\', the activity or resource is available to students (subject to any access restrictions which may be set).<br /><br />If the availability is set to \'Hide from students\', the activity or resource is only available to users with permission to view hidden activities (by default, users with the role of teacher or non-editing teacher).<br /><br />If the course contains many activities or resources, the course page may be simplified by setting the availability to \'Make available but not shown on course page\'. In this case, a link to the activity or resource must be provided from elsewhere, such as from a page resource. The activity would still be listed in the gradebook and other reports.</p></div>" data-html="true" tabindex="0" data-trigger="focus">\n                                            <i class="icon fa fa-circle-question text-info fa-fw " title="Help with Availability" role="img" aria-label="Help with Availability"></i>\n                                            </a>\n                                        </span>\n                                        <label style="line-height: 18px;" class="blclabel" for="id_visible">\n                                            Availability\n                                        </label>\n                                        </div>\n                                        <div class="blcrow" data-fieldtype="modvisible">\n                                            <select class="custom-select " name="visible" id="id_visible">\n                                                <option value="1" selected="">Show on course page</option>\n                                                <option value="0">Hide from students</option>\n                                                '+allowstealthstring+'\n                                            </select>\n                                            <div class="form-control-feedback invalid-feedback" id="id_error_visible"></div>\n                                        </div>\n                                    </div>\n                                    <br/>\n                                    <div class="blcrow">\n                                        <div class="blccolmd6">\n                                            <span style="float:left; margin-right:10px;" class="text-nowrap">\n                                                <a style="box-shadow: none; background: none; padding-bottom:3px !important; border:none;" class="btn btn-link p-0 prev" role="button" id="" data-container="body" data-toggle="popover" data-placement="right" data-content="<div class=&quot;no-overflow&quot;><p>Preview mode allows a student to browse an activity before attempting it. If preview mode is disabled, the preview button is hidden.</p> </div> " data-html="true" tabindex="0" data-trigger="focus">\n                                                   \n                                                <i class="icon fa fa-circle-question text-info fa-fw " title="Help with Availability" role="img" aria-label="Help with Availability"></i>                                               \n                                                </a>\n                                            </span>\n                                            <label style="line-height: 18px;" class="blclabel" for="id_hidebrowse">\n                                                Disable preview mode\n                                            </label>\n                                        </div>\n                                        <div class="blcrow" style="" data-fieldtype="selectyesno">\n                                            <select class="custom-select" name="hidebrowse" id="id_hidebrowse">\n                                                <option value="0">No</option>\n                                                <option value="1" selected="">Yes</option>\n                                            </select>\n                                            <div class="form-control-feedback invalid-feedback" id="id_error_hidebrowse"></div>\n                                        </div>\n                                    </div>\n                                    <br/>\n                                    <div class="blcrow">\n                                        <div class="blccolmd6">\n                                            <span style="float:left; margin-right:10px;" class="text-nowrap">\n                                                <a style="box-shadow: none; background: none; padding-bottom:3px !important; border:none;" class="btn btn-link p-0 comp" id="" role="button" data-container="body" data-toggle="popover" data-placement="right" data-content="<div class=&quot;no-overflow&quot;><p>If enabled, activity completion is tracked, either manually or automatically.<br/> If Automatic is selected, the best options for BLC modules are set, whereas if manual is selected, the studnt must manually tick a box next to the activity for it to register as complete.</p> <p>A tick next to the activity name on the course page indicates when the activity is complete.</p> </div>" data-html="true" tabindex="0" data-trigger="focus">\n                                                        <i class="icon fa fa-circle-question text-info fa-fw " title="Help with Availability" role="img" aria-label="Help with Availability"></i>                                               \n                                            \n                                                </a>\n                                            </span>\n                                            <label class="blclabel" style="line-height: 18px;" for="id_completion">\n                                                Completion tracking\n                                            </label>\n                                        </div>\n                                        <div class="blccolmd6" style="" data-fieldtype="select">\n                                            '+completionstring+'\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-default closeModal" data-dismiss="modal">\n                                Close\n                            </button>\n                            <button type="button" disabled="disabled" class="btn btn-primary submitForm">\n                                Add Modules\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            ');$("#section-0 .content").css("margin-right"),$("#wwwroot_hidden").html();$(".section.main").each((function(){1==notifyeditingon&&($(this).append('\n                            <button class="btn add-content btn-blc-modules d-flex justify-content-center align-items-center p-1 icon-no-margin pull-right" \n                                    data-toggle=\'modal\' data-target=\'#bsModal3\' style="float:right">\n                                <div class="px-1">\n                                    <i class="icon fa fa-plus fa-fw" aria-hidden="true"></i>\n                                    <span class="activity-add-text pr-1">Add BLC modules</span>\n                                </div>\n                            </button>\n                        '),(()=>{const button=document.querySelector(".btn-blc-modules"),defaultBackgroundColor="#cfe2f2",hoverBackgroundColor="#0f6cbf",hoverTextColor="white",defaultTextColor="black";button.addEventListener("mouseenter",(()=>{button.style.backgroundColor=hoverBackgroundColor,button.style.color=hoverTextColor})),button.addEventListener("mouseleave",(()=>{button.style.backgroundColor=defaultBackgroundColor,button.style.color=defaultTextColor}))})());var margin=$(".row").css("margin-left");"-30px"!=margin&&"-20px"!=margin||($(".form-group").css("margin-left","5px"),$(".float-sm-right").css("float","left"))})),$("#scormsubject").change((function(){fillscorm()})),$(".course-content").on("click",".add-scrom",(function(){fillSubject();var secNum=$(this).closest(".section").attr("id").split("-")[1];x=secNum})),$("#scormurls").click((function(){$(".submitForm").removeAttr("disabled")})),$(".course-content").on("click",".submitForm",(function(){var apikey=$("#apikey").val(),scormurls=[],visibility=$("#id_visible").val(),hidebrowse=$("#id_hidebrowse").val(),completion=$("#id_completion").val();$.each($("#scormurls option:selected"),(function(){var urll=$(this).val();urll=urll.replace(",","qqq"),scormurls.push(urll)})),$(".statusMsg").html(""),$(".submitForm").attr("disabled","disabled"),$(".closeModal").attr("disabled","disabled"),$(".modal-header").append('<i class="fa fa-spinner fa-spin" style="font-size:24px"></i>'),$.get(root+"/blocks/blc_modules/load_scorm.php",{id:id,sectionNumber:x,scormurls:scormurls,apikey:apikey,visibility:visibility,hidebrowse:hidebrowse,completion:completion},(function(data,status){'"completed"'==data?location.reload(!0):($(".statusMsg").html('<span style="color:red;">'+data+"</p>"),$(".submitForm").removeAttr("disabled"),$(".modal-header .fa.fa-spinner").remove())}))})),$(".select2").select2({dropdownParent:$("#bsModal3")})}$(".activityinstance").on("click",".fa-refresh",(function(){var data=$(this).closest(".cmid-version").attr("id");updateScorm(data.split("-")[0],data.split("-")[1])}))},tippyInit:function(){tippy(".avail",{content:"<div class=&quot;no-overflow&quot;><p>If the availability is set to 'Show on course page', the activity or resource is available to students (subject to any access restrictions which may be set).<br /><br /> If the availability is set to 'Hide from students', the activity or resource is only available to users with permission to view hidden activities (by default, users with the role of teacher or non-editing teacher).<br /><br /> If the course contains many activities or resources, the course page may be simplified by setting the availability to 'Make available but not shown on course page'. In this case, a link to the activity or resource must be provided from elsewhere, such as from a page resource. The activity would still be listed in the gradebook and other reports.</p> </div> ",theme:"light",arrow:!0,placement:"right"}),tippy(".prev",{content:"<div class=&quot;no-overflow&quot;><p>Preview mode allows a student to browse an activity before attempting it. If preview mode is disabled, the preview button is hidden.</p> </div> ",theme:"light",arrow:!0,placement:"right"}),tippy(".comp",{content:"<div class=&quot;no-overflow&quot;><p>If enabled, activity completion is tracked, either manually or automatically.<br/> If Automatic is selected, the best options for BLC modules are set, whereas if manual is selected, the studnt must manually tick a box next to the activity for it to register as complete.</p> <p>A tick next to the activity name on the course page indicates when the activity is complete.</p> </div>",theme:"light",arrow:!0,placement:"right"})},bulkUpdateInit:function(){$(document).ready((function(){var checkExist=setInterval((function(){$("#modalForm").modal&&($("#modalForm").modal("show"),$("#bulkupdatecont").click((function(){$("#bulkupdatesubmit").submit()})),clearInterval(checkExist))}),500)}))}};function getUrlParameter(url,sParam){var sParameterName,i,sURLVariables=decodeURIComponent(url.split("?")[1]).split("#");for(i=0;i<sURLVariables.length;i++)if((sParameterName=sURLVariables[i].split("="))[0]===sParam)return void 0===sParameterName[1]||sParameterName[1];return!1}function fillSubject(){var apikey=$("#apikey").val();$("#scormurls").html(""),$.getJSON(root+"/blocks/blc_modules/load_scormsubject.php?apikey="+encodeURIComponent(apikey),(function(data){var items=[];0==data.length&&($(".submitForm").attr("disabled","disabled"),$(".statusMsg").html('<span style="color:red;">An error has occured.</p>')),items.push("<option disabled selected>Select a module</option>"),$.each(data,(function(key,val){items.push("<option value='"+key+"'>"+val+"</option>")})),$("#scormsubject").html(items.join(""))}))}function checkVersion(id){var apikey=$("#apikey").val();$.getJSON(root+"/blocks/blc_modules/version_check.php?apikey="+encodeURIComponent(apikey)+"&id="+id,(function(data){$.each(data,(function(key,val){$("#module-"+key+" .mod-indent-outer .activityinstance").append('<li class="cmid-version" id="'+key+"-"+val+'"><i id="updatescorm"  style="cursor: pointer;" class="icon fa fa-refresh fa-fw " title="New version available" aria-label="Update"></i>')}))}))}function fillscorm(){var scormsubject=$("#scormsubject option:selected").text(),apikey=$("#apikey").val();0!=scormsubject&&$.getJSON(root+"/blocks/blc_modules/load_scormurls.php?apikey="+encodeURIComponent(apikey)+"&subject="+encodeURIComponent(scormsubject),(function(data){var items=[];$.each(data,(function(key,val){var sanVal=val.replace(".zip","");key=key.replace("'","’"),items.push("<option style='-moz-white-space: pre-wrap; -o-white-space: pre-wrap; white-space: pre-wrap;' value='"+key+"'>"+sanVal+"</option>")})),$("#scormurls").html(items.join(""))}))}function updateScorm(cmid,version){$.ajax({type:"GET",url:root+"/blocks/blc_modules/update_scorm.php",data:"cmid="+cmid+"&version="+version,beforeSend:function(){$("#module-"+cmid+" .mod-indent-outer .cmid-version").append('<i class="fa fa-spinner fa-spin" style="font-size:24px"></i>')},success:function(){location.reload(!0)}})}}));

//# sourceMappingURL=module.min.js.map