define("block_blc_modules/module",["exports","jquery","tippy.js"],(function(_exports,_jquery,_tippy){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Manager for the blc_modules block.
   *
   * @module block_blc_modules/module
   * @author      Yahya Rais <yahya@teruselearning.co.uk>
   * @copyright   2022 Terus Technology LTD
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.tippyInit=_exports.init=_exports.bulkUpdateInit=void 0,_jquery=_interopRequireDefault(_jquery),_tippy=_interopRequireDefault(_tippy);var root=M.cfg.wwwroot,x="";_exports.init=()=>{var pageURL=(0,_jquery.default)(location).attr("href"),id=((url,sParam)=>{var sParameterName,i,sURLVariables=decodeURIComponent(url.split("?")[1]).split("#");for(i=0;i<sURLVariables.length;i++)if((sParameterName=sURLVariables[i].split("="))[0]===sParam)return void 0===sParameterName[1]||sParameterName[1]})(pageURL=(pageURL=pageURL.split("&")[0]).split("#")[0],"id"),notifyeditingon=(0,_jquery.default)("#userediting").val();if(1==notifyeditingon&&(id=>{var apikey=(0,_jquery.default)("#apikey").val();_jquery.default.getJSON(root+"/blocks/blc_modules/version_check.php?apikey="+encodeURIComponent(apikey)+"&id="+id,(function(data){_jquery.default.each(data,(function(key,val){(0,_jquery.default)("#module-"+key+" .mod-indent-outer .activityinstance").append('<li class="cmid-version" id="'+key+"-"+val+'"><i id="updatescorm"  style="cursor: pointer;" class="icon fa fa-refresh fa-fw " title="New version available" aria-label="Update"></i>')}))}))})(id),(0,_jquery.default)("#addscorm").hasClass("block_blc_modules")){notifyeditingon=(0,_jquery.default)("#userediting").val();var allowstealthstring="";1==(0,_jquery.default)("#allowstealthvalue").val()&&(allowstealthstring='<option value="-1">Make available but not shown</option>');var completionstring="";completionstring=1==(0,_jquery.default)("#completionon").val()?'<select class="custom-select " name="completion" id="id_completion"> <option value="0">Off</option> <option value="1" >Manual</option> <option value="2" selected="">Automatic</option> </select> <div class="form-control-feedback invalid-feedback" id="id_error_completion">':'<p>Activity completion is not enabled on this course.</p><div class="form-control-feedback invalid-feedback" id="id_error_completion">',(0,_jquery.default)(".course-content").append('\n            <div style="display:none;" class="modal fade" id="bsModal3" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">\n                <div class="modal-dialog modal-md">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <h4 class="modal-title" id="mySmallModalLabel">\n                                Select BLC Modules\n                            </h4>\n                        </div>\n                    <div class="modal-body">\n                        <p class="statusMsg"></p>\n                        <form role="form">\n                        <div class="form-group">\n                            <select style="min-width:100%;" class="form-control" id="scormsubject" name="scormsubject"></select>\n                        </div>\n                        <div class="form-group">\n                            <select style="min-width:100%;" class="form-control" id="scormurls" name="scormurls" multiple ></select>\n                        </div>\n                        <div class="additional_settings">\n                            <h3>SCORM Settings</h3>\n                            <div class="blcrow">\n                                <div class="blcrow">\n                                    <span style="float:left; margin-right:10px;" class="text-nowrap">\n                                        <a style="box-shadow: none; background: none; padding-bottom:3px !important; border:none;" class="btn btn-link p-0 avail" id="" role="button" data-container="body" data-toggle="popover" data-placement="right" data-content="<div class=&quot;no-overflow&quot;><p>If the availability is set to \'Show on course page\', the activity or resource is available to students (subject to any access restrictions which may be set).<br /><br />If the availability is set to \'Hide from students\', the activity or resource is only available to users with permission to view hidden activities (by default, users with the role of teacher or non-editing teacher).<br /><br />If the course contains many activities or resources, the course page may be simplified by setting the availability to \'Make available but not shown on course page\'. In this case, a link to the activity or resource must be provided from elsewhere, such as from a page resource. The activity would still be listed in the gradebook and other reports.</p></div>" data-html="true" tabindex="0" data-trigger="focus">\n                                            <img src="'+root+'/blocks/blc_modules/pix/question.png" style="max-width: 20px;" onclick="event.preventDefault();" aria-hidden="true" title="Help with Availability" aria-label="Help with Availability" />\n                                        </a>\n                                    </span>\n                                    <label style="line-height: 18px;" class="blclabel" for="id_visible">\n                                        Availability\n                                    </label>\n                                    </div>\n                                    <div class="blcrow" data-fieldtype="modvisible">\n                                        <select class="custom-select " name="visible" id="id_visible">\n                                            <option value="1" selected="">Show on course page</option>\n                                            <option value="0">Hide from students</option>\n                                            '+allowstealthstring+'\n                                        </select>\n                                        <div class="form-control-feedback invalid-feedback" id="id_error_visible"></div>\n                                    </div>\n                                </div>\n                                <br/>\n                                <div class="blcrow">\n                                    <div class="blccolmd6">\n                                        <span style="float:left; margin-right:10px;" class="text-nowrap">\n                                            <a style="box-shadow: none; background: none; padding-bottom:3px !important; border:none;" class="btn btn-link p-0 prev" role="button" id="" data-container="body" data-toggle="popover" data-placement="right" data-content="<div class=&quot;no-overflow&quot;><p>Preview mode allows a student to browse an activity before attempting it. If preview mode is disabled, the preview button is hidden.</p> </div> " data-html="true" tabindex="0" data-trigger="focus">\n                                                <img src="../blocks/blc_modules/pix/question.png" style="max-width: 20px;" onclick="event.preventDefault();" aria-hidden="true" title="Help with Availability" aria-label="Help with Availability" />\n                                            </a>\n                                        </span>\n                                        <label style="line-height: 18px;" class="blclabel" for="id_hidebrowse">\n                                            Disable preview mode\n                                        </label>\n                                    </div>\n                                    <div class="blcrow" style="" data-fieldtype="selectyesno">\n                                        <select class="custom-select" name="hidebrowse" id="id_hidebrowse">\n                                            <option value="0">No</option>\n                                            <option value="1" selected="">Yes</option>\n                                        </select>\n                                        <div class="form-control-feedback invalid-feedback" id="id_error_hidebrowse"></div>\n                                    </div>\n                                </div>\n                                <br/>\n                                <div class="blcrow">\n                                    <div class="blccolmd6">\n                                        <span style="float:left; margin-right:10px;" class="text-nowrap">\n                                            <a style="box-shadow: none; background: none; padding-bottom:3px !important; border:none;" class="btn btn-link p-0 comp" id="" role="button" data-container="body" data-toggle="popover" data-placement="right" data-content="<div class=&quot;no-overflow&quot;><p>If enabled, activity completion is tracked, either manually or automatically.<br/> If Automatic is selected, the best options for BLC modules are set, whereas if manual is selected, the studnt must manually tick a box next to the activity for it to register as complete.</p> <p>A tick next to the activity name on the course page indicates when the activity is complete.</p> </div>" data-html="true" tabindex="0" data-trigger="focus">\n                                                <img src="../blocks/blc_modules/pix/question.png" style="max-width: 20px;" onclick="event.preventDefault();" aria-hidden="true" title="Help with Availability" aria-label="Help with Availability" />\n                                            </a>\n                                        </span>\n                                        <label class="blclabel" style="line-height: 18px;" for="id_completion">\n                                            Completion tracking\n                                        </label>\n                                    </div>\n                                    <div class="blccolmd6" style="" data-fieldtype="select">\n                                        '+completionstring+'\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="modal-footer">\n                        <button type="button" class="btn btn-default closeModal" data-dismiss="modal">\n                            Close\n                        </button>\n                        <button type="button" disabled="disabled" class="btn btn-primary submitForm">\n                            Add Modules\n                        </button>\n                    </div>\n                </div>\n            </div>\n        ');var mright=(0,_jquery.default)("#section-0 .content").css("margin-right");(0,_jquery.default)("#wwwroot_hidden").html();(0,_jquery.default)(".section.main").each((function(){1==notifyeditingon&&(0,_jquery.default)(this).append("<a style='float:right; margin-right:"+mright+"; cursor: pointer; color: #a864a8;' class='add-scrom' data-toggle='modal' data-target='#bsModal3'><img style='padding-bottom:3px;' src='"+root+"/blocks/blc_modules/pix/blc.png'/>   Add BLC modules</a>");var margin=(0,_jquery.default)(".row").css("margin-left");"-30px"!=margin&&"-20px"!=margin||((0,_jquery.default)(".form-group").css("margin-left","5px"),(0,_jquery.default)(".float-sm-right").css("float","left"))})),(0,_jquery.default)("#scormsubject").change((function(){var scormsubject,apikey;scormsubject=(0,_jquery.default)("#scormsubject option:selected").text(),apikey=(0,_jquery.default)("#apikey").val(),0!=scormsubject&&_jquery.default.getJSON(root+"/blocks/blc_modules/load_scormurls.php?apikey="+encodeURIComponent(apikey)+"&subject="+encodeURIComponent(scormsubject),(function(data){var items=[];_jquery.default.each(data,(function(key,val){var sanVal=val.replace(".zip","");key=key.replace("'","â€™"),items.push("<option style='-moz-white-space: pre-wrap; -o-white-space: pre-wrap; white-space: pre-wrap;' value='"+key+"'>"+sanVal+"</option>")})),(0,_jquery.default)("#scormurls").html(items.join(""))}))})),(0,_jquery.default)(".course-content").on("click",".add-scrom",(function(){var apikey;apikey=(0,_jquery.default)("#apikey").val(),_jquery.default.getJSON(root+"/blocks/blc_modules/load_scormsubject.php?apikey="+encodeURIComponent(apikey),(function(data){var items=[];0==data.length&&((0,_jquery.default)(".submitForm").attr("disabled","disabled"),(0,_jquery.default)(".statusMsg").html('<span style="color:red;">An error has occured.</p>')),_jquery.default.each(data,(function(key,val){items.push("<option value='"+key+"'>"+val+"</option>")})),items=items.sort(),(0,_jquery.default)("#scormsubject").html(items.join(""))}));var secNum=(0,_jquery.default)(this).closest(".section").attr("id").split("-")[1];x=secNum})),(0,_jquery.default)("#scormurls").click((function(){(0,_jquery.default)(".submitForm").removeAttr("disabled")})),(0,_jquery.default)(".course-content").on("click",".submitForm",(function(){var apikey=(0,_jquery.default)("#apikey").val(),scormurls=[],visibility=(0,_jquery.default)("#id_visible").val(),hidebrowse=(0,_jquery.default)("#id_hidebrowse").val(),completion=(0,_jquery.default)("#id_completion").val();_jquery.default.each((0,_jquery.default)("#scormurls option:selected"),(function(){var urll=(0,_jquery.default)(this).val();urll=urll.replace(",","qqq"),scormurls.push(urll)})),(0,_jquery.default)(".statusMsg").html(""),(0,_jquery.default)(".submitForm").attr("disabled","disabled"),(0,_jquery.default)(".closeModal").attr("disabled","disabled"),(0,_jquery.default)(".modal-header").append('<i class="fa fa-spinner fa-spin" style="font-size:24px"></i>'),_jquery.default.get(root+"/blocks/blc_modules/load_scorm.php",{id:id,sectionNumber:x,scormurls:scormurls,apikey:apikey,visibility:visibility,hidebrowse:hidebrowse,completion:completion},(function(data,status){'"completed"'==data?location.reload(!0):((0,_jquery.default)(".statusMsg").html('<span style="color:red;">'+data+"</p>"),(0,_jquery.default)(".submitForm").removeAttr("disabled"),(0,_jquery.default)(".modal-header .fa.fa-spinner").remove())}))}))}(0,_jquery.default)(".activityinstance").on("click",".fa-refresh",(function(){var data=(0,_jquery.default)(this).closest(".cmid-version").attr("id");((cmid,version)=>{_jquery.default.ajax({type:"GET",url:root+"/blocks/blc_modules/update_scorm.php",data:"cmid="+cmid+"&version="+version,beforeSend:function(){(0,_jquery.default)("#module-"+cmid+" .mod-indent-outer .cmid-version").append('<i class="fa fa-spinner fa-spin" style="font-size:24px"></i>')},success:function(){location.reload(!0)}})})(data.split("-")[0],data.split("-")[1])}))};_exports.tippyInit=()=>{(0,_tippy.default)(".avail",{content:"<div class=&quot;no-overflow&quot;><p>If the availability is set to 'Show on course page', the activity or resource is available to students (subject to any access restrictions which may be set).<br /><br /> If the availability is set to 'Hide from students', the activity or resource is only available to users with permission to view hidden activities (by default, users with the role of teacher or non-editing teacher).<br /><br /> If the course contains many activities or resources, the course page may be simplified by setting the availability to 'Make available but not shown on course page'. In this case, a link to the activity or resource must be provided from elsewhere, such as from a page resource. The activity would still be listed in the gradebook and other reports.</p> </div> ",theme:"light",arrow:!0,placement:"right"}),(0,_tippy.default)(".prev",{content:"<div class=&quot;no-overflow&quot;><p>Preview mode allows a student to browse an activity before attempting it. If preview mode is disabled, the preview button is hidden.</p> </div> ",theme:"light",arrow:!0,placement:"right"}),(0,_tippy.default)(".comp",{content:"<div class=&quot;no-overflow&quot;><p>If enabled, activity completion is tracked, either manually or automatically.<br/> If Automatic is selected, the best options for BLC modules are set, whereas if manual is selected, the studnt must manually tick a box next to the activity for it to register as complete.</p> <p>A tick next to the activity name on the course page indicates when the activity is complete.</p> </div>",theme:"light",arrow:!0,placement:"right"})};_exports.bulkUpdateInit=()=>{(0,_jquery.default)(document).ready((function(){var checkExist=setInterval((function(){(0,_jquery.default)("#modalForm").modal&&((0,_jquery.default)("#modalForm").modal("show"),(0,_jquery.default)("#bulkupdatecont").click((function(){(0,_jquery.default)("#bulkupdatesubmit").submit()})),clearInterval(checkExist))}),500)}))}}));

//# sourceMappingURL=module.min.js.map